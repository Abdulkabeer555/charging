<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Battery Charging Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse {
      0% { opacity: 0.5; }
      50% { opacity: 1; }
      100% { opacity: 0.5; }
    }
    .pulse-animation {
      animation: pulse 1.5s infinite;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center flex-col p-6">

  <h1 class="text-3xl font-bold mb-4">Real-Time Charging %</h1>
  <div class="text-5xl font-mono" id="percentage">--.--</div>
  <div class="mt-2 text-gray-400" id="status">Loading...</div>

  <script>
    const percentageDisplay = document.getElementById('percentage');
    const statusText = document.getElementById('status');

    let lastLevel = null;
    let lastLevelTime = null;
    let interval = null;
    let simulatedDecimal = 0;

    function simulateDecimals(currentPercent, durationMs) {
      clearInterval(interval);
      simulatedDecimal = 0;

      const stepTime = durationMs / 100;

      interval = setInterval(() => {
        if (simulatedDecimal >= 100) simulatedDecimal = 99;
        const simulatedValue = (currentPercent + simulatedDecimal / 100).toFixed(2);
        percentageDisplay.textContent = simulatedValue;
        simulatedDecimal++;
      }, stepTime);
    }

    function stopSimulation() {
      clearInterval(interval);
    }

    if ('getBattery' in navigator) {
      navigator.getBattery().then(battery => {

        function update() {
          const level = Math.floor(battery.level * 100);
          const isCharging = battery.charging;

          if (!isCharging) {
            stopSimulation();
            percentageDisplay.textContent = (battery.level * 100).toFixed(2);
            statusText.textContent = 'Not Charging';
            return;
          }

          statusText.textContent = 'Charging...';

          if (lastLevel === null) {
            lastLevel = level;
            lastLevelTime = Date.now();
            percentageDisplay.textContent = (battery.level * 100).toFixed(2);
          } else if (level !== lastLevel) {
            // Percent changed (e.g. 56 â†’ 57)
            const now = Date.now();
            const duration = now - lastLevelTime; // ms
            simulateDecimals(lastLevel, duration);
            lastLevel = level;
            lastLevelTime = now;
          }
        }

        update(); // initial
        battery.addEventListener('levelchange', update);
        battery.addEventListener('chargingchange', update);

        // check every 2s
        setInterval(update, 2000);
      });
    } else {
      percentageDisplay.textContent = '--.--';
      statusText.textContent = 'Battery API not supported';
    }
  </script>

</body>
</html>
