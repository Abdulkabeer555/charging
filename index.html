<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery Charging Indicator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
        .battery-terminal {
            width: 6px;
            height: 12px;
            background-color: #4a5568;
            border-radius: 2px 2px 0 0;
        }
        .battery-body {
            position: relative;
            width: 100px;
            height: 180px;
            border: 3px solid #4a5568;
            border-radius: 8px;
            overflow: hidden;
        }
        .battery-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #48bb78, #68d391);
            transition: height 0.5s ease;
        }
        .lightning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.8);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">Device Charging Status</h1>
        <p class="text-gray-300">Real-time battery percentage monitoring</p>
    </div>

    <div class="flex flex-col items-center">
        <div class="relative mb-6">
            <div class="battery-terminal mx-auto"></div>
            <div class="battery-body">
                <div id="batteryFill" class="battery-fill"></div>
                <div id="lightningIcon" class="lightning">
                    <i class="fas fa-bolt"></i>
                </div>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 shadow-lg w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-300 font-medium">Current Charge:</span>
                <span id="chargingStatus" class="text-green-400 font-semibold flex items-center">
                    <i class="fas fa-bolt mr-2 text-yellow-400"></i> Charging
                </span>
            </div>
            
            <div class="text-center">
                <div id="percentageDisplay" class="text-5xl font-bold text-white mb-2">00.00</div>
                <div class="text-gray-400 text-sm">Last updated: <span id="updateTime">Just now</span></div>
            </div>
            
            <div class="mt-6">
                <div class="flex justify-between text-gray-400 text-sm mb-1">
                    <span>0%</span>
                    <span>100%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div id="progressBar" class="bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-4xl">
        <div class="bg-gray-800 p-4 rounded-lg">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-900 text-blue-300 mr-3">
                    <i class="fas fa-battery-three-quarters"></i>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">Battery Health</div>
                    <div class="text-white font-medium">Good</div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-purple-900 text-purple-300 mr-3">
                    <i class="fas fa-clock"></i>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">Time Remaining</div>
                    <div id="timeRemaining" class="text-white font-medium">Calculating...</div>
                </div>
            </div>
        </div>
        <div class="bg-gray-800 p-4 rounded-lg">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-900 text-green-300 mr-3">
                    <i class="fas fa-plug"></i>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">Power Source</div>
                    <div class="text-white font-medium">AC Power</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const percentageDisplay = document.getElementById('percentageDisplay');
        const batteryFill = document.getElementById('batteryFill');
        const progressBar = document.getElementById('progressBar');
        const updateTime = document.getElementById('updateTime');
        const timeRemaining = document.getElementById('timeRemaining');
        const lightningIcon = document.getElementById('lightningIcon');
        const chargingStatus = document.getElementById('chargingStatus');

        let currentDisplayedPercentage = 0;
        let animationInterval = null;

        // Formats a number to two decimal places, ensuring 00 for integers
        function formatPercentage(level) {
            return (level * 100).toFixed(2);
        }

        function animatePercentage(startValue, endValue, duration = 1000) {
            let startTime = null;
            const diff = endValue - startValue;

            function step(currentTime) {
                if (!startTime) startTime = currentTime;
                const progress = (currentTime - startTime) / duration;

                if (progress < 1) {
                    currentDisplayedPercentage = startValue + (diff * progress);
                    percentageDisplay.textContent = formatPercentage(currentDisplayedPercentage / 100);
                    animationInterval = requestAnimationFrame(step);
                } else {
                    currentDisplayedPercentage = endValue;
                    percentageDisplay.textContent = formatPercentage(endValue / 100);
                }
            }
            if (animationInterval) {
                cancelAnimationFrame(animationInterval);
            }
            animationInterval = requestAnimationFrame(step);
        }

        function updateBatteryDisplay(battery) {
            const actualPercentage = Math.floor(battery.level * 100); // e.g., 56 for 0.56

            // If actual percentage changed, or if it's the first run, update the animation target
            if (Math.floor(currentDisplayedPercentage) !== actualPercentage) {
                // Ensure currentDisplayedPercentage is never higher than actualPercentage
                if (currentDisplayedPercentage / 100 > battery.level) {
                     currentDisplayedPercentage = actualPercentage;
                }
                animatePercentage(currentDisplayedPercentage, actualPercentage, 2000); // Animate over 2 seconds
            }

            batteryFill.style.height = `${battery.level * 100}%`;
            progressBar.style.width = `${battery.level * 100}%`;
            
            // Update time
            const now = new Date();
            updateTime.textContent = now.toLocaleTimeString();
            
            // Update charging status
            if (battery.charging) {
                chargingStatus.innerHTML = '<i class="fas fa-bolt mr-2 text-yellow-400"></i> Charging';
                lightningIcon.style.display = 'block';
                lightningIcon.classList.add('pulse-animation');
                
                // Estimate time remaining (very rough estimate)
                if (battery.level < 1) {
                    const minsRemaining = Math.round((1 - battery.level) * 180); // ~3 hours for full charge
                    timeRemaining.textContent = `${minsRemaining} min remaining`;
                } else {
                    timeRemaining.textContent = "Fully charged";
                }
            } else {
                chargingStatus.innerHTML = '<i class="fas fa-battery-three-quarters mr-2"></i> Not Charging';
                lightningIcon.style.display = 'none';
                lightningIcon.classList.remove('pulse-animation');
                timeRemaining.textContent = "Not charging";
            }
            
            // Change color based on level
            if (battery.level > 0.8) {
                progressBar.classList.remove('bg-green-500', 'bg-yellow-500');
                progressBar.classList.add('bg-green-300');
            } else if (battery.level > 0.2) {
                progressBar.classList.remove('bg-green-300', 'bg-yellow-500');
                progressBar.classList.add('bg-green-500');
            } else {
                progressBar.classList.remove('bg-green-500', 'bg-green-300');
                progressBar.classList.add('bg-yellow-500');
            }
        }

        // Initialize with real battery data
        if ('getBattery' in navigator) {
            navigator.getBattery().then(function(battery) {
                // Initial update
                currentDisplayedPercentage = Math.floor(battery.level * 100);
                updateBatteryDisplay(battery);
                
                // Set up event listeners
                battery.addEventListener('chargingchange', () => updateBatteryDisplay(battery));
                battery.addEventListener('levelchange', () => updateBatteryDisplay(battery));
                // No need for chargingtimechange or dischargingtimechange for this specific decimal animation
            });
        } else {
            percentageDisplay.textContent = "00.00";
            chargingStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-2 text-red-400"></i> API not supported';
            timeRemaining.textContent = "Battery API not available";
        }
    </script>
</body>
</html>
